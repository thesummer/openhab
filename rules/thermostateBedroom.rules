
rule "Bedroom default"
when
    System started
then
    bedroomTemperatureComfort.sendCommand(19.0)
    bedroomTemperatureEco.sendCommand(16.0)
end

rule "Bedroom thermostate set state"
when
    Time cron "0 30 22 1/1 * ? *" or
    Time cron "0 30 6 1/1 * ? *"  or
    Item JanOnline changed
then
    val turnOnTime = now.withTimeAtStartOfDay.plusHours(22).plusMinutes(30)
    val turnOffTime = now.withTimeAtStartOfDay.plusHours(6).plusMinutes(30)

    logInfo("bedroomTempChangeState", "SetBRState starting...")

    if (JanOnline.state == OPEN && (now.isAfter(turnOnTime) || now.isBefore(turnOffTime)))
    {
        logInfo("bedroomTempChangeState", "Setting heater status to COMFORT")
        brHeaterState.sendCommand("COMFORT")
    }
    else
    {
        logInfo("bedroomTempChangeState", "Setting heater status to ECO")
        bedroomHeaterState.sendCommand("ECO")
    }
    logInfo("bedroomTempChangeState", "SetBRState finished")
end

rule "Bedroom heater set temperature"
when
    Item brHeaterState changed or 
    Item bedroomTemperatureComfort changed or
    Item bedroomTemperatureEco changed
then

    logInfo("brTemp", "Bedroom heater state set to " + brHeaterState.state)
    switch (brHeaterState.state)
    {
    case "MANUAL": 
        logInfo("brTemp", "Set current set point to " + bedroomTemperatureComfort.state.toString())
    case "ECO":
        logInfo("bedroomTemp", "Set current set point to " + bedroomTemperatureEco.state.toString())
        bedroom_thermostat_SetpointTemperature.sendCommand(bedroomTemperatureEco.state)
//    case "COMFORT":
//        logInfo("bedroomTemp", "Set current set point to " + bedroomTemperatureComfort.state.toString())
//        bedroom_thermostat_SetpointTemperature.sendCommand(bedroomTemperatureComfort.state)
    }
end
